#!/usr/bin/env python

import md5 #Must be run in python 2.7.x
import sys
import socket
import re

#seed = sys.argv[1] #"3501672ebc68a5524629080e3ef60aef"
#match = sys.argv[2] # "e26d7e19b69192b94af14c4b208c8c9a"

def getPrevHash(seed, match):
    hashc = seed
    prevc = ""
    for _ in xrange(100):
        prevc = hashc
        hashc = md5.new(hashc).hexdigest()
        if hashc in match:
            break;
    return prevc


dict = {
'4925':'eaae5e04a259d09af85c108fe4d7dd0c',
'458':'d07e70efcfab08731a97e7b91be644de',
'7354':'547b85f3fafdf30856386753dc21c4e1',
'8660':'bc27acd4e787c0a32597d6e4b8254851',
'7011':'970627414218ccff3497cb7a784288f5',
'6491':'cd17d3ce3b64f227987cd92cd701cc58',
'4299':'cabad3b9bc0afe08cd9ec861638ed1d9',
'2040':'4c144c47ecba6f8318128703ca9e2601',
'1320':'2a50e9c2d6b89b95bcb416d6857f8b45',
'2024':'07811dc6c422334ce36a09ff5cd6fe71',
'4130':'c929f2210333206f417e3862f431776d',
'7151':'fc394e9935fbd62c8aedc372464e1965',
'5644':'8db1d4a631a6e9a24e2c0e842e1f1772',
'6464':'894a9b94bcc5969b60bd18e8ea9c0ddc',
'126':'069059b7ef840f0c74a814ec9237b6ec',
'4571':'bfd2308e9e75263970f8079115edebbd',
'912':'2a9d121cd9c3a1832bb6d2cc6bd7a8a7',
'3243':'38811c5285e34e2e3319ab7d9f2cfa5b',
'403':'bbf94b34eb32268ada57a3be5062fe7d',
'1944':'6f2688a5fce7d48c8d19762b88c32c3b',
'9818':'7c7077ca5231fd6ad758b9d49a2a1eeb',
'3991':'dfbd282c18300fa0eccceea6c5fac41f',
'3046':'975e6107778ce7a40b9878bfb96a16a7',
'635':'6a10bbd480e4c5573d8f3af73ae0454b',
'1222':'3a029f04d76d32e79367c4b3255dda4d',
'8625':'105405695aa6c6e0e203fbf4df13a1d5',
'9217':'f4db8537e9d75da46c4efc36a2d70956',
'1019':'03e0704b5690a2dee1861dc3ad3316c9',
'9436':'cc9109aa1f048c36d154d902612982e2',
'9650':'1f490b64a7d1716e9952d627b9baa45e',
'5631':'cacbf64b8a464fa1974da1eb0aa92851',
'3352':'0987b8b338d6c90bbedd8631bc499221',
'9301':'42ba513c42a0fd6558aa44b1de658140',
'422':'f85454e8279be180185cac7d243c5eb3',
'7874':'305ddad049f65a2c241dbb6e6f746c54',
'9481':'689016f6ee80ef507e2f5d67614b4be8',
'5691':'87784eca6b0dea1dff92478fb786b401',
'6134':'1ca5c750a30312d1919ae6a4d636dcc4',
'8324':'e5fc3b8d9510b02e42361c337597d9fa',
'7796':'94841421fb5e84a4d83e303949e6b211',
'9239':'5aa3405a3f865c10f420a4a7b55cbff3',
'9466':'d117dca133c64bf78a4b7696dd007189',
'7015':'885fe656777008c335ac96072a45be15',
'4624':'9d8df73a3cfbf3c5b47bc9b50f214aff',
'49':'f457c545a9ded88f18ecee47145a72c0',
'5107':'9f93557d309f655ff06f109a08dcf7c4',
'5968':'8c97dbeee3b0d40ced7f514b99a93d93',
'4125':'5bf8aaef51c6e0d363cbe554acaf3f20',
'1250':'81e5f81db77c596492e6f1a5a792ed53',
'4866':'d403137434343677b98efc88cbd5493d',
'9158':'316282ddb77e11b0b58c60ed59b1e308',
'7853':'260c2432a0eecc28ce03c10dadc078a4',
'4295':'a57d48399922b03419153a9760c5ce53',
'335':'f9b902fc3289af4dd08de5d1de54f68f',
'2248':'be6c7b094f88532b6c6b35bbcd525ee8',
'76':'fbd7939d674997cdb4692d34de8633c4',
'2418':'db60b95decdeed944b4cd8685417cfdc',
'34':'e369853df766fa44e1ed0ff613f563bd',
'6914':'8b2dfbe0c1d43f9537dae01e96458ff1',
'3792':'4ecb679fd35dcfd0f0894c399590be1a',
'6506':'6a711a119a8a7a9f877b5f379bfe9ea2',
'5866':'a7471fdc77b3435276507cc8f2dc2569',
'5843':'b4a0e0fbaa9f16d8947c49f4e610b549',
'6028':'2c60e40b399dc55d8b755ec6b5d09f8a',
'3626':'0ee8b85a85a49346fdff9665312a5cc4',
'5001':'03b264c595403666634ac75d828439bc',
'2596':'bd70364a8fcba02366697df66f50b4d4',
'401':'816b112c6105b3ebd537828a39af4818',
'8160':'89d9c467c2926de8ef12d1f3e006d06b',
'7568':'088660d31e3314b1c5817fa45e9f25f1',
'4058':'8133415ea4647b6345849fb38311cf32',
'2388':'d04863f100d59b3eb688a11f95b0ae60',
'4285':'63cb524a9f51b7858733e1108bf556fa',
'7273':'9d702ffd99ad9c70ac37e506facc8c38',
'323':'bc6dc48b743dc5d013b1abaebd2faed2',
'4832':'0a934ecab584f7a4cd0220a7caeccbcc',
'7061':'6495cf7ca745a9443508b86951b8e33a',
'9132':'21186d7b1482412ab14f0332b8aee119',
'5095':'45be58330c9a2ac2bc408ec210820fab',
'2530':'55a988dfb00a914717b3000a3374694c',
'6314':'ec20019911a77ad39d023710be68aaa1',
'6645':'b8fd7211e5247891e4d4f0562418868a',
'6463':'a2f04745390fd6897d09772b2cd1f581',
'5704':'ce11641e056f7b59aef8e9a42eaeb65b',
'3270':'3f7bcd0b3ea822683bba8fc530f151bd',
'4723':'53420bd6e6798761679772a7dd012674',
'713':'07c5807d0d927dcd0980f86024e5208b',
'5610':'049671e28a386427e432b3370a22aae4',
'4442':'77305c2f862ad1d353f55bf38e5a5183',
'145':'2b24d495052a8ce66358eb576b8912c8',
'5069':'739cf54211aa6b75dd3001d54064e7a7',
'26':'4e732ced3463d06de0ca9a15b6153677',
'8833':'349f8e8088df63050757dd8be4356216',
'2609':'339a18def9898dd60a634b2ad8fbbd58',
'9868':'76460865551007d38ffbb834d5896ea4',
'691':'10a5ab2db37feedfdeaab192ead4ac0e',
'3371':'285da2198b2b496c9d447cc4ac6b0734',
'8854':'bd6fd20524553da5f0504d31e4134500',
'5437':'0a3b6f64f0523984e51323fe53b8c504',
'4472':'103303dd56a731e377d01f6a37badae3',
'385':'dc912a253d1e9ba40e2c597ed2376640',
'3669':'e1228be46de6a0234ac22ded31417bc7',
'8287':'6120d42c7249acb7b2cfcf020bf7ab75',
'3544':'147ebe637038ca50a1265abac8dea181',
'890':'024d7f84fff11dd7e8d9c510137a2381',
'1874':'958adb57686c2fdec5796398de5f317a',
'7880':'46ba59a6994802347d659680875fb173',
'7690':'c6776f93bc9afe2e511a1dbd5478362c',
'8801':'97ea3cfb64eeaa1edba65501d0bb3c86',
'7068':'abc99d6b9938aa86d1f30f8ee0fd169f',
'5748':'1db3fa8e5bbd04882892f478a301a311',
'652':'30ef30b64204a3088a26bc2e6ecf7602',
'6000':'a8c6dd982010fce8701ce1aef8a2d40a',
'3675':'845f3cb43a07259b2e4724dfa5c5c0d1',
'8472':'6d1e481bdcf159961818823e652a7725',
'8335':'36455d3b4aa959a5a5799f2316c06660',
'7050':'0f7b2bb5d0c7e6209ecff113108f64cf',
'4698':'1068bceb19323fe72b2b344ccf85c254',
'7608':'3133f88cbe33bcd01a6ba439d75ae996',
'8226':'abcc5329cfe5846db63ff4dee74eb906',
'5881':'6d378765f17a856b7ba8bf1541cafb69',
'9523':'db079083386e2e0885f278fbd1d8a476',
'1299':'a0833c8a1817526ac555f8d67727caf6',
'7567':'90ef635b07e4335585e9aa6c7d742e94',
'4283':'3e1953b572576cc82887d4100a29a02c',
'9909':'1980fa3bbff704c8bec1b7196cf7dfbc',
'690':'c06d06da9666a219db15cf575aff2824',
'2058':'1359aa933b48b754a2f54adb688bfa77',
'9645':'be16d5d77fc088f250f94227280ec528',
'9125':'f7f84297f903c4ae67e9b17ebb49c5a3',
'3827':'b5b8c484824d8a06f4f3d570bc420313',
'1332':'28e209b61a52482a0ae1cb9f5959c792',
'5495':'b05bf587ec7ce83518b72eb0d011a353',
'7000':'708be71b9ab6e0a84252760579ade9f1',
'9543':'7364e0bb7f15ebfbc9e12d5b13f51a02',
'5781':'8e2c381d4dd04f1c55093f22c59c3a08',
'7424':'420824960f755f8721c47b6027ead6ab',
'3469':'ca851e9f71b25d2d588b7e0d4de3d627',
'4641':'5ffaa9f5182c2a36843f438bb1fdbdea',
'8854':'bd6fd20524553da5f0504d31e4134500',
'8114':'b20fa060328b0cdf51b464ee37efe182',
'4496':'bdf3fd65c81469f9b74cedd497f2f9ce',
'6831':'4d0b954f0bef437c29dfa73fafdf3fa5',
'1070':'dc58e3a306451c9d670adcd37004f48f',
'5904':'05ae14d7ae387b93370d142d82220f1b',
'6028':'2c60e40b399dc55d8b755ec6b5d09f8a',
'8735':'52130c418d4f02c74f74a5bc1f8020b2',
'9772':'c86c6aae8fa9b90ac77534c5ea7a2fe7',
'7708':'84253ffce9853bdf2518c53ddf3bce65',
'5146':'717729ce391c20ef3e722c3e6ef79a58',
'4004':'f8eb278a8bce873ef365b45e939da38a',
'6685':'f72f78a365657d56853b6867fb37dc3c',
'6207':'62db9e3397c76207a687c360e0243317',
'7547':'3783f31a590c99846281c4534e05bc6b',
'7387':'21be992eb8016e541a15953eee90760e',
'7902':'66fe2bcc701bb627e111be6847a8436c',
'6275':'22c432f46fd86e1be5bc4429282eb65d',
'8233':'b6af2c9703f203a2794be03d443af2e3',
'766':'959a557f5f6beb411fd954f3f34b21c3',
'7072':'29e11ea8ec6c7804a7f939e8e78e9c18',
'2231':'2a8a812400df8963b2e2ac0ed01b07b8',
'1005':'2387337ba1e0b0249ba90f55b2ba2521',
'2941':'4b21cf96d4cf612f239a6c322b10c8fe',
'6281':'f86890095c957e9b949d11d15f0d0cd5',
'3707':'2ad9e5e943e43cad612a7996c12a8796',
'4996':'e586a4f55fb43a540c2e9dab45e00f53',
'4671':'722caafb4825ef5d8670710fa29087cf',
'6712':'5726daf2c9ee0f955eca58291c26d2f3',
'4979':'9f96f36b7aae3b1ff847c26ac94c604e',
'6256':'a87c11b9100c608b7f8e98cfa316ff7b',
'6402':'72c25197b6a491816d9a84b42d7205f0',
'367':'05049e90fa4f5039a8cadc6acbb4b2cc',
'2505':'8c1b6fa97c4288a4514365198566c6fa',
'5733':'0a988fc2992add2d3233e19c7aadfdea',
'4015':'587524833eaf98eb779a387e33768c6a',
'3648':'cff02a74da64d145a4aed3a577a106ab',
'9203':'d97d404b6119214e4a7018391195240a',
'5726':'2c8ed8587468aec2462a3914f154e570',
'5861':'ccdf3864e2fa9089f9eca4fc7a48ea0a',
'4656':'55563844bcd4bba067fe86ac1f008c7e',
'1382':'4e0d67e54ad6626e957d15b08ae128a6',
'1130':'4a213d37242bdcad8e7300e202e7caa4',
'4909':'457ded6f20b28feb21b9bca73c498671',
'9688':'80b0c85e6c57765e36477a986b101ede',
'9918':'097fdff1eefae7180f5ec716a83dd3a3',
'960':'437d7d1d97917cd627a34a6a0fb41136',
'2151':'350db081a661525235354dd3e19b8c05',
'8542':'4ee0932f46276313b51570f46266a608',
'6943':'6a783b626a6d892a132dc195e5504272',
'1256':'e3251075554389fe91d17a794861d47b',
'1771':'21be9a4bd4f81549a9d1d241981cec3c',
'2875':'4f1f29888cabf5d45f866fe457737a23',
'9489':'ab2ce2a4bbb59dab4f43dada87ef0e23',
'5170':'1f5069142727648138a54524b5beeb58',
'433':'019d385eb67632a7e958e23f24bd07d7',
'9178':'ebc03fa648c2cd7da9d63b9ed835664e',
'2101':'c5866e93cab1776890fe343c9e7063fb',
'8647':'c47eedbcf5a800ee4216797e5665eb21',
'8174':'fc5a29b5d423c94cdfacb0f706eecdb7',
'7581':'0b794a03744a03800313ca0f2e291294',
'8071':'82138b11a724b94d18df2e083d8b7b55',
'9135':'bf65417dcecc7f2b0006e1f5793b7143',
'7279':'f75dddd1e79826a219cb0bec217dc096',
'6159':'ac1ae6a547bf25a11284c7595eff6df7',
'3140':'747d3443e319a22747fbb873e8b2f9f2',
'6596':'a85edfa24307bad582dbfb9713d7eb6b',
'5225':'169582a799e5b6c46fdfd432379f60d8',
'4332':'f2c3b258e9cd8ba16e18f319b3c88c66',
'8622':'0c52d419a421fb13bb58357e67b7fb4b',
'1739':'752d25a1f8dbfb2d656bac3094bfb81c',
'7325':'4e093aa7417fe0881bc5fbda7322a74e',
'2253':'ce6c92303f38d297e263c7180f03d402',
'581':'c6e19e830859f2cb9f7c8f8cacb8d2a6',
'698':'99bcfcd754a98ce89cb86f73acc04645',
'9261':'43f8e83d15ca083fb58e9b745e5de0d4',
'2289':'43351f7bf9a215be70c2c2caa7555002',
'6629':'488e4104520c6aab692863cc1dba45af',
'4610':'700a4d3e9b7edabf9e4b69008b0718d6',
'3409':'20125fd9b2d43e340a35fb0278da235d',
'3026':'0cdf61037d7053ca59347ab230818335',
'2633':'fc03d48253286a798f5116ec00e99b2b',
'5586':'8153349b1eb6f6c01622d4f395993bfe',
'6467':'92650b2e92217715fe312e6fa7b90d82',
'4933':'db8419f41d890df802dca330e6284952',
'4483':'4607f7fff0dce694258e1c637512aa9d',
'3287':'946e3ece1fc8b24bd656449d88eca941',
'5174':'8df7c2e3c3c3be098ef7b382bd2c37ba',
'1790':'d25414405eb37dae1c14b18d6a2cac34',
'185':'eecca5b6365d9607ee5a9d336962c534',
'2836':'6e0e24295e8a86282cb559b860416812',
'9509':'2bdfb48c5fa7d2344b71ef45c8a7d31c',
'9928':'68c86f3f9a4eefdc3180f488ac749db5',
'6510':'a3fc981af450752046be179185ebc8b5',
'5349':'6c468ec5a41d65815de23ec1d08d7951',
'4265':'53c5b2affa12eed84dfec9bfd83550b1',
'1529':'aa486f25175cbdc3854151288a645c19',
'7727':'2156795824e042092b04e970977114cd',
'3584':'565767eb96d87d0d3af8dfb332c2003f',
'6':'1679091c5a880faf6fb5e6087eb1b2dc',
'865':'3b3dbaf68507998acd6a5a5254ab2d76',
'9577':'08ae6a26b7cb089ea588e94aed36bd15',
'6721':'a0d3973ad100ad83a64c304bb58677dd',
'5659':'94b087da83ceb5fe6f1a13150f8c0471',
'9089':'28b805f5645425ce44eaf6bcba79a40c',
'9930':'2c8eff687fe094e24be91e72a45ff884',
'6302':'a0608743660c09feb35a28905143a085',
'3503':'87f7ee4fdb57bdfd52179947211b7ebb',
'8111':'30410be149e6771f60881182342452d5',
'671':'5dd9db5e033da9c6fb5ba83c7a7ebea9',
'7187':'1e932f24dc0aa4e7a6ac2beec387416d',
'5892':'f1daf122cde863010844459363cd31db',
'9913':'0e999d31b23f3f89049b91cc014296c8',
'4228':'e464f78f1b3fa6bfe6d887029bf66f0c',
'4658':'cd61a580392a70389e27b0bc2b439f49',
'9367':'4abe2907e5149b18b63f7e88d5abf475',
'4831':'f720ec3e5486f090fd382b68e230b435',
'1648':'7437d136770f5b35194cb46c1653efaa',
'9959':'05ec04f7fb3bc3281f1db83bfc1a2490',
'6850':'44ece762ae7e41e3a0b1301488907eaa',
'5643':'bee3d07327a21d8e7f02e10ba4b35c15',
'1905':'73e0f7487b8e5297182c5a711d20bf26',
'6630':'4de1ed74128a96a8b5900186486aacba',
'8260':'a73d2d60ed472454a0360027aa039bdb',
'9592':'b538f279cb2ca36268b23f557a831508',
'643':'9b698eb3105bd82528f23d0c92dedfc0',
'7215':'b17446af05919be6e83500be7f5df5c4',
'9220':'e4d09d3f57c2c971c8b2bf8efb416a0a',
'4387':'6b4e2b9376139fa09a68b94ec04dbe94',
'7300':'220787ad7829c9cbc7e9953cb1c36fb3',
'8001':'bc3c4a6331a8a9950945a1aa8c95ab8a',
'9871':'4bd6a600d4cb755c07712c599a95da2b',
'5991':'c0356641f421b381e475776b602a5da8',
'4532':'1d38dd921e15520709f86320185c5e1d',
'2086':'f80ff32e08a25270b5f252ce39522f72',
'8015':'1f7aa6705d5b742085538c627f6f9c2b',
'6104':'46384036044a604b6b3316fc167fc15f',
'5892':'f1daf122cde863010844459363cd31db',
'3887':'9649dec6196d730c5e024f204477d8d1',
'8906':'41d6c2482cdf34113f998e9df192e148',
'925':'7fa732b517cbed14a48843d74526c11a',
'2614':'5df07ecf4cea616e3eb384a9be3511bb',
'5755':'840d68cbbbfa627cd4635408a6c82009',
'269':'06138bc5af6023646ede0e1f7c1eac75',
'5447':'623a1f8e55863044aa680a8fa581c36a',
'9005':'6872937617af85db5a39a5243e858d1f',
'1907':'77369e37b2aa1404f416275183ab055f',
'8228':'03573b32b2746e6e8ca98b9123f2249b',
'7824':'c154d855a0f33bb1ee7365af5a204279',
'8072':'85dfba75bcadb576723264b5986f2ac2',
'2582':'7e83722522e8aeb7512b7075311316b7',
'5229':'080acdcce72c06873a773c4311c2e464',
'6287':'57827ddd068a17ad6dfc6690962241e5',
'3823':'bca382c81484983f2d437f97d1e141f3',
'8223':'3e91970f771a2c473ae36b60d1146068',
'6975':'6084e82a08cb979cf75ae28aed37ecd4',
'1045':'a0e2a2c563d57df27213ede1ac4ac780',
'5215':'a71378c0f8d76dbf90feeecd095d0ed9',
'731':'59c33016884a62116be975a9bb8257e3',
'17':'70efdf2ec9b086079795c442636b55fb',
'2695':'dbbf603ff0e99629dda5d75b6f75f966',
'1836':'f26dab9bf6a137c3b6782e562794c2f2',
'9792':'6754828e66a922ed1b376ef3f43b625e',
'9720':'aedf8c04c36592dbe313d5938e1cd45e',
'2879':'ec8b57b0be908301f5748fb04b0714c7',
'7408':'545e91a14706478dc240764245cd4bd1',
'8686':'8d4112ce0aabe7aeef422c136a222624',
'4678':'ac4d17530106c3e3c2fb5e2dad0e51b7',
'9511':'58d2f92539a5492fe6ef1e7375c6e9b6',
'2781':'ae587cfeea5ac21a8f1c1ea51027fef0',
'199':'84d9ee44e457ddef7f2c4f25dc8fa865',
'9362':'7296d81c3d5e425bc1785994bea8a0d2',
'3495':'8485ae387a981d783f8764e508151cd9',
'457':'42998cf32d552343bc8e460416382dca',
'1695':'e721a54a8cf18c8543d44782d9ef681f',
'7349':'ad8d3a0a0f0a084a97fad357c649438c',
'1785':'393c55aea738548df743a186d15f3bef',
'576':'a7aeed74714116f3b292a982238f83d2',
'7705':'76d4110e944e83212bafa4b11ebf2b7e',
'3271':'bfbb56bee68d99affaa64f189045d5f2',
'7251':'3472ab80b6dff70c54758fd6dfc800c2',
'7294':'bc047286b224b7bfa73d4cb02de1238d',
'2061':'52dbb0686f8bd0c0c757acf716e28ec0',
'6895':'7bcd91571fc1119e87d81e1054255e73',
'6359':'51db672ac302a163017367f46d48f602',
'7908':'42d0c639a21482dcd8e1c447efe87e89',
'198':'0e65972dce68dad4d52d063967f0a705',
'9946':'a26475af783877529bf81eed81743d71',
'617':'5d44ee6f2c3f71b73125876103c8f6c4',
'573':'e5f6ad6ce374177eef023bf5d0c018b6',
'6701':'e987eff4a7c7b7e580d659feb6f60c1a',
'6447':'88ccf9a98e8519b2011df33952832f2f',
'8581':'c75e10ef9ef6d295d4ceba8335d93bdd',
'5148':'482db0ecc10b8a9984ae850c9ada9899',
'4205':'22785dd2577be2ce28ef79febe80db10',
'371':'41f1f19176d383480afa65d325c06ed0',
'6520':'80fee67c8a4c4989bf8a580b4bbb0cd2',
'2664':'daaaf13651380465fc284db6940d8478',
'User': 'Seed'
}
# ADD DICT> (.+) (.+)
# '\1':'\2',
i = 0
while True:
    s = socket.socket()
    s.connect(('shell2017.picoctf.com', 55973))
    while True:
        data = str(s.recv(4096))
        if data != "":
            print("RECV>" + data)
            if 'r/f?' in data:
                i += 1
                print "i=", i
                if i >= 10:
                    i = 0
                    s.send("f\n")
                else:
                    s.send("r\n")
            elif 'Hello new user! ' in data:
                regex = re.search(r"Your ID is now (.+) and your assigned hashchain seed is (.+)", data)
                id_num = int(regex.group(1))
                if dict.has_key(id_num):
                    print "Skip"
                    break
                dict[id_num] = regex.group(2)
                print "ADD DICT> '%d': '%s', " % (id_num, dict[id_num])

                regex = re.search(r":(.+)$", data.replace("\n", "").strip())
                match = regex.group(1)
                s.send( getPrevHash(dict[id_num], match) + "\n")
            elif "Yep! That's it! You're validated" in data:
                break
            elif 'Please authenticate as user' in data:
                regex = re.search(r"Please authenticate as user (.+?)", data.strip())
                auth_user = regex.group(1)
                if not dict.has_key(auth_user):
                    break
                match = data.split("\n")[2] #3rd line is the hash
                next = getPrevHash(dict[auth_user], match)
                s.send( next + "\n" )
                sys.exit()


